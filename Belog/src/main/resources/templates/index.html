<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline Service</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@500&display=swap">
    <title>My First Blog</title>

    <style>
        /* 글작성 버튼 스타일 */
        .post-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .write-button {
            display: inline-block;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: #fff;
            text-decoration: none;
            border-radius: 4px;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }
        .write-button:hover {
            background-color: #3e8e41;
        }
        /* 글작성 폼 스타일 */
        .write-form {
            display: none;
            margin-bottom: 16px;
            border: 1px solid #ddd;
            padding: 16px;
        }
        .write-form input[type="text"],
        .write-form input[type="password"],
        .write-form textarea {
            width: 100%;
            margin-bottom: 8px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .write-form .half-width {
            width: 20%;
            display: inline-block;
            margin-right: 16px;
        }
        .write-form button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            margin-right: 8px;
        }
        .write-form button:hover {
            background-color: #3e8e41;
        }
        /* 글제목 스타일 */
        .title-link {
            display: block;
            font-size: 20px;
            font-weight: bold;
            color: #333;
            text-decoration: none;
        }
        .title-link:hover {
            color: #4CAF50;
        }
        /* 컨테이너 스타일 */
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 16px;
        }

        .post-info .title-link {
            margin-right: 16px;
        }
        .post-info .author-date {
            font-size: 14px;
            color: #666;
        }
    </style>

    <script>
        $(document).ready(function () {
            // HTML 문서를 로드할 때마다 실행합니다.
            getMessages();
        })

        function formatDate(dateString) {
            let date = new Date(dateString);
            let year = date.getFullYear();
            let month = ("0" + (date.getMonth() + 1)).slice(-2);
            let day = ("0" + date.getDate()).slice(-2);
            let hour = ("0" + date.getHours()).slice(-2);
            let minute = ("0" + date.getMinutes()).slice(-2);

            return `${year}-${month}-${day} ${hour}:${minute}`;
        }

        function getMessages() {
            // 1. 기존 메모 내용을 지웁니다.
            $('#post-info').empty();

            // 2. 메모 목록을 불러와서 HTML로 붙입니다.
            $.ajax({
                type: "GET",
                url: "/api/memos",
                data: {},
                success: function (response) {
                    for (let i = 0; i < response.length; i++) {
                        let message = response[i];
                        let id = message['id'];
                        let title = message['title'];
                        let username = message['username'];
                        let contents = message['contents'];
                        let modifiedAt = formatDate(message['modifiedAt']);
                        addHTML(id,title, username, contents, modifiedAt);
                    }
                }
            });
        }
        function addHTML(id, title, username, contents, modifiedAt) {
            let tempHtml = makeMessage(id, title, username, contents, modifiedAt);
            $('#post-info').append(tempHtml);
        }
        function editPost(contentId) {
            // 여기에 수정 기능을 구현하세요.
        }
        function makeMessage(id, title, username, contents, modifiedAt) {
            const previewContent = contents.length > 20 ? contents.slice(0, 20) + '...' : contents;

            return `
<div class="post-container">
<hr style="border: solid 2px gold;">
        <div>
            <h2>
                <span>${id}.번째글 </span>
                <a href="#content${id}" class="title-link" onclick="toggleContent('content${id}')">제목 : ${title}</a>
            </h2>
            <div class="content" id="content${id}" style="display:none;">
                <p class="content-full" style="display:block;">내용 : ${contents}</p>
                <div class="content-buttons" style="display:block; text-align:right;">
                    <button class="write-button" onclick="editPost('content${id}')">수정</button>
                    <button class="write-button">삭제</button>
                </div>
            </div>
            <p class="content-preview" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${previewContent}</p>
            <span class="author-date">작성자 ${username}| 작성날짜 ${modifiedAt}</span>
        </div>
        <hr style="border: solid 2px gold;">
    </div>
`;
        }



        function toggleContent(id) {
            const content = document.getElementById(id);
            const contentPreview = content.parentElement.querySelector('.content-preview');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                contentPreview.style.display = 'none';
            } else {
                content.style.display = 'none';
                contentPreview.style.display = 'block';
            }
        }


        function toggleWriteForm() {
            const writeForm = document.querySelector(".write-form");
            if (writeForm.style.display === "block") {
                writeForm.style.display = "none";
            } else {
                writeForm.style.display = "block";
            }
        }

        function submitPost() {
            // 1. 작성한 메모를 불러옵니다.
            let title = $('#title').val();
            let username = $('#username').val();
            let contents = $('#contents').val();
            let password = $('#password').val();

            // 2. 작성한 메모가 올바른지 isValidContents 함수를 통해 확인합니다.
            // if (isValidContents(contents) == false) {
            //     return;
            // }

            // 3. genRandomName 함수를 통해 익명의 username을 만듭니다.
            // let username = genRandomName(10);

            // 4. 전달할 data JSON으로 만듭니다.
            let data = {'title':title,'username': username, 'contents': contents,'password':password};
            $.ajax({
                type: "POST",
                url: "/api/create",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function (response) {
                    alert('메시지가 성공적으로 작성되었습니다.');
                    window.location.reload();
                }
            });

        }

        function cancelPost() {
            toggleWriteForm();
        }
    </script>
</head>
<body>
<div class="container">
    <h1 style="text-align:center;">My First Blog</h1>
    <button class="write-button" onclick="toggleWriteForm()">글작성</button>
    <div class="write-form">
        <h2 style="margin-top: 0;">글 작성</h2>
        <form>
            <label for="title">제목</label>
            <input type="text" id="title" name="title" required value="제목입니다">
            <div class="half-width">
                <label for="username">작성자</label>
                <input type="text" id="username" name="username" required value="작성자구요">
            </div>
            <div class="half-width">
                <label for="password">비밀번호</label>
                <input type="password" id="password" name="password" required value="비번이에요">
                <br>
            </div>
            <br>

            <label for="contents">내용</label>
            <textarea id="contents" name="contents" rows="6" required>내용입니다</textarea>
            <div style="text-align:right;">
                <button type="submit" onclick="submitPost()">완료</button>
                <button type="button" onclick="cancelPost()">취소</button>
            </div>
        </form>
    </div>
    <hr>
    <div class="post-info" id="post-info">


    </div>

    <!-- 추가적인 글 내용은 여기에 추가할 수 있습니다. -->
</div>
</body>
</html>

